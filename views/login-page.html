<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoosterManagement</title>
  <link rel="stylesheet" href="./login-page.css" />
</head>

<body>
  <!-- TOP BAR -->
  <header>
    <div class="top-bar">
      <div class="top-bar-left">
        <a href="/">
          <span class="logo">RoosterManagement</span>
        </a>
      </div>
      <div class="top-bar-right" id="top-bar-right" style="display: none;">
        <button id="logout-btn" class="secondary-button">Logout</button>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT (ORTALANMIŞ LOGIN / SIGN UP) -->
  <main class="main">
    <section class="hero">
      <!-- SADECE AUTH CARD -->
      <div class="card" id="auth-card">
        <div class="card-title">Account</div>

        <div class="auth-tabs">
          <button class="auth-tab-button active" data-auth="login">Log In</button>
          <button class="auth-tab-button" data-auth="signup">Sign Up</button>
        </div>

        <!-- LOGIN FORM -->
        <form class="auth-form" id="login-form">
          <div class="form-field">
            <label>Email</label>
            <input type="email" placeholder="you@example.com" required />
          </div>
          <div class="form-field">
            <label>Password</label>
            <input type="password" placeholder="Password" required />
          </div>
          <button type="submit" class="secondary-button full-width">
            Log In
          </button>
          <p class="small-note">
            Don't have an account?
            <span class="link-text" id="go-signup">Sign up</span>
          </p>
        </form>

        <!-- SIGN UP FORM -->
        <form class="auth-form" id="signup-form" style="display: none;">
          <div class="form-field">
            <label>First Name</label>
            <input type="text" placeholder="First Name" required />
          </div>
          <div class="form-field">
            <label>Last Name</label>
            <input type="text" placeholder="Last Name" required />
          </div>
          <div class="form-field">
            <label>Email</label>
            <input type="email" placeholder="you@example.com" required />
          </div>
          <div class="form-field">
            <label>Password</label>
            <input type="password" placeholder="Password" required />
          </div>
          <div class="form-field">
            <label>Confirm Password</label>
            <input type="password" placeholder="Confirm Password" required />
          </div>
          <button type="submit" class="secondary-button full-width">
            Sign Up
          </button>
          <p class="small-note">
            Already have an account?
            <span class="link-text" id="go-login">Log in</span>
          </p>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <div>Privacy · Cookie Policy · Contact</div>
    </div>
  </footer>

  <script>
    // -----------------------------
    // CHECK LOGIN STATUS ON PAGE LOAD
    // -----------------------------
    function checkLoginStatus() {
      const token = localStorage.getItem("token");
      const authCard = document.getElementById("auth-card");
      const topBarRight = document.getElementById("top-bar-right");

      if (token) {
        // User is logged in
        authCard.style.display = "none";
        topBarRight.style.display = "block";
      } else {
        // User is not logged in
        authCard.style.display = "block";
        topBarRight.style.display = "none";
      }
    }

    // Check on page load
    checkLoginStatus();

    // Logout button handler
    document.getElementById("logout-btn").addEventListener("click", () => {
      localStorage.removeItem("token");
      checkLoginStatus();
      alert("You have been logged out.");
    });

    // -----------------------------
    // AUTH TAB SWITCHING
    // -----------------------------
    const authTabButtons = document.querySelectorAll(".auth-tab-button");
    const loginForm = document.getElementById("login-form");
    const signupForm = document.getElementById("signup-form");
    const goSignup = document.getElementById("go-signup");
    const goLogin = document.getElementById("go-login");

    function switchAuthTab(tab) {
      authTabButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.auth === tab);
      });
      loginForm.style.display = tab === "login" ? "block" : "none";
      signupForm.style.display = tab === "signup" ? "block" : "none";
    }

    authTabButtons.forEach(btn => {
      btn.addEventListener("click", () => switchAuthTab(btn.dataset.auth));
    });

    goSignup.addEventListener("click", () => switchAuthTab("signup"));
    goLogin.addEventListener("click", () => switchAuthTab("login"));

    // -----------------------------
    // SCROLL TO AUTH CARD
    // -----------------------------
    const scrollToAuthBtn = document.getElementById("scrollToAuth");
    const authCard = document.getElementById("auth-card");

    if (scrollToAuthBtn) {
      scrollToAuthBtn.addEventListener("click", () => {
        authCard.scrollIntoView({ behavior: "smooth", block: "center" });
        switchAuthTab("login");
      });
    }

    // -----------------------------
    // SIGNUP FORM SUBMIT
    // -----------------------------
    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const first_name = e.target[0].value.trim();
      const last_name = e.target[1].value.trim();
      const email = e.target[2].value.trim();
      const password = e.target[3].value;
      const confirmPassword = e.target[4].value;

      if (password !== confirmPassword) {
        alert("Passwords do not match.");
        return;
      }

      try {
        const res = await fetch("http://localhost:3000/api/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ first_name, last_name, email, password, confirmPassword })
        });

        const data = await res.json();
        alert(data.message);

        if (res.status === 201) {
          switchAuthTab("login");
        }
      } catch (err) {
        console.error(err);
        alert("Something went wrong. Try again.");
      }
    });

    // -----------------------------
    // LOGIN FORM SUBMIT
    // -----------------------------
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = e.target[0].value.trim();
      const password = e.target[1].value;

      try {
        const res = await fetch("http://localhost:3000/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();

        if (res.ok) {
          alert(data.message);
          localStorage.setItem("token", data.token);
          window.location.href = "/";
        } else {
          alert(data.message);
        }
      } catch (err) {
        console.error(err);
        alert("Something went wrong. Try again.");
      }
    });
  </script>

</body>

</html>